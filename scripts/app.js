angular.module("search",["ngSanitize","ngRoute","search.services","search.controllers"]).config(["$routeProvider",function(e){return e.when("/search",{}).otherwise({redirectTo:"/search"})}]);var indexOf=[].indexOf;angular.module("search.controllers",["search.services"]).controller("SearchController",["$scope","$filter","$location","$http","cities",function(o,e,r,t,n){var i;return o.query=r.search(),o.result=[],o.query.c=o.query.c||"sss",o.hide_city_list=!0,o.errors=[],o.cities=n,o.categories={ccc:"community",eee:"events",ggg:"gigs",hhh:"housing",jjj:"jobs",ppp:"personals",res:"resumes",sss:"for sale",bbb:"services"},o.search=function(e){var n;if(e.cities=(()=>{for(var e=o.cities.selected(),r=[],t=0,s=e.length;t<s;t++)n=e[t],r.push(n.slug);return r})().join(","),r.search(e),o.query.q)return o.errors.length=0,o.result.length=0,o.load(),o.hide_city_list=!0},o.load=function(){var c=function(i){return function(e){var r,t,s,n;if(i.status="processing",e.error)return o.errors.push(i.name),i.status="error";for(t=0,s=(n=e.feed.entries).length;t<s;t++)(r=n[t]).publishedDate=Date.parse(r.publishedDate);return o.result=o.result.concat(e.feed.entries),i.status="success",o.$apply()}};return o.result.length=0,o.cities.promise.then(function(){for(var e,r,t=o.cities.selected(),s=[],n=0,i=t.length;n<i;n++)e=t[n],r=new google.feeds.Feed(`http://${e.slug}.craigslist.org/search/${o.query.c}?query=${o.query.q}&sort=date&format=rss`),e.status="pending",r.setNumEntries(100),s.push(r.load(c(e)));return s})},o.set_all_cities=function(e){for(var r,t=o.cities.all,s=[],n=0,i=t.length;n<i;n++)r=t[n],s.push(r.selected=e);return s},o.now=function(){return new Date},i=(o.query.cities||"").split(","),o.cities.promise.then(function(){for(var e,r=n.all,t=0,s=r.length;t<s;t++)(e=r[t]).selected=0<=indexOf.call(i,e.slug);return o.search(o.query)})}]),angular.module("search").filter("delta",function(){return function(e){var e=Math.floor(e/1e3),r=Math.floor(e/60),t=Math.floor(r/60),s=Math.floor(t/24);return 0<s?s+"d "+(t-24*s)+"h":0<t?t+"h "+(r-60*t)+"m":0<r?r+"m "+(e-60*r)+"s":e+"s"}}),angular.module("search.services",[]).factory("cities",["$http","$filter","$q",function(e,r,t){var s=[];return{all:s,promise:e.get("data/cities.json").success(function(e){return angular.copy(e,s)}),selected:function(){return r("filter")(this.all,{selected:!0})}}}]);